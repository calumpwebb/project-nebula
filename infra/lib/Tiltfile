def nebula_service(
    name,
    image=None,
    dockerfile=None,
    context=".",
    manifests=None,
    port_forwards=[],
    resource_deps=[],
    labels=[],
    live_update=[],
):
    """
    Standard Nebula service definition.
    Handles image building, k8s deployment, and Tilt resource config.
    """

    if dockerfile and image:
        docker_build(
            image,
            context,
            dockerfile=dockerfile,
            live_update=live_update,
        )

    if manifests:
        k8s_yaml(manifests)

    k8s_resource(
        name,
        port_forwards=port_forwards,
        resource_deps=resource_deps,
        labels=labels or ['app'],
    )

    return name


def infra_service(name, **kwargs):
    """Convenience wrapper for infrastructure services."""
    kwargs.setdefault('labels', ['infra'])
    return nebula_service(name, **kwargs)
